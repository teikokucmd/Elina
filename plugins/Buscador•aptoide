import Starlights from '@StarlightsTeam/Scraper';

let handler = async (m, { conn, command, text, usedPrefix }) => {
    if (!text) return conn.reply(m.chat, 'ğŸš© Ingresa el nombre de la aplicaciÃ³n que deseas buscar en Aptoide.', m);

    await m.react('ğŸ•“');

    try {
        let results = await Starlights.aptoideSearch(text);
        if (!results || results.length === 0) return conn.reply(m.chat, 'âŒ No se encontraron resultados', m);

        
        let listSections = [];

        
        const firstApp = results[0];
        listSections.push({
            title: `âœ¨ **Primer resultado:**`,
            highlight_label: 'Popular',
            rows: [
                {
                    header: '',
                    title: `â­ ${firstApp.name}`,
                    description: `ğŸ“¦ ID: ${firstApp.id}\nğŸ”— Url: https://m.aptoide.com/app/${firstApp.id}`,
                    id: `${usedPrefix}aptoidedl ${firstApp.id}`
                }
            ]
        });

        
        for (let i = 1; i < (results.length >= 30 ? 30 : results.length); i++) {
            const app = results[i];

            listSections.push({
                title: `AplicaciÃ³n Nro ${i + 1}`,
                rows: [
                    {
                        header: '',
                        title: `â­ ${app.name}`,
                        description: `ğŸ“¦ ID: ${app.id}\nğŸ”— Url: https://m.aptoide.com/app/${app.id}`,
                        id: `${usedPrefix}aptoidedl ${app.id}`
                    }
                ]
            });
        }

        
        await conn.sendListB(m.chat, `*ğŸ’ A P T O I D E - B Ãš S Q U E D A*`, `Resultados de: *${text}*`, 'Resultados', 'https://qu.ax/dXXhQ.jpg', listSections, m);
        
        await m.react('âœ…');
    } catch (error) {
        console.error(error);
        await m.react('âœ–ï¸');
    }
};

handler.tags = ['search'];
handler.help = ['aptoidesearch *<bÃºsqueda>*'];
handler.command = ['aptoidesearch', 'aptoide','apkmod', 'apk'];

export default handler;
